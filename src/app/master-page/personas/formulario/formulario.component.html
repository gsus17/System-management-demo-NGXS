<div fxFlex
     *ngIf="(viewdata$ | async)?.countries.length > 0 && form !== undefined"
     fxLayout="column"
     fxLayoutAlign="center center">

  <mat-toolbar color="primary">
    <span class="mat-title">{{(viewdata$ | async)?.titleForm | translate}}</span>
  </mat-toolbar>
  <div class="general-container form-container"
       fxFlexLayout="row"
       fxLayoutAlign="center center">
    <mat-card class="card-form"
              fxFlex>
      <mat-card-title>
        {{'PERSON_FORM.TITLE' | translate}}
      </mat-card-title>
      <mat-card-content>

        <form [formGroup]="form"
              ngxsForm="persons.form"
              fxFlex
              fxLayout="column">
          <section fxLayout="column">
            <div fxLayout="row">

              <mat-form-field fxFlex
                              class="example-full-width">
                <input matInput
                       name="name"
                       formControlName="name"
                       placeholder="{{'PERSON_FORM.COMPLETED_USER_LABEL' | translate}}">
                <mat-hint align="start">
                  <span>{{'PERSON_FORM.USER_HINT' | translate}}</span>
                </mat-hint>
                <mat-error *ngIf="validateError('name') && getErrors('name').required">
                  {{'PERSON_FORM.USER_ERROR' | translate}}
                </mat-error>
              </mat-form-field>
            </div>
            <div fxLayout="row">
              <mat-form-field fxFlex
                              class="example-full-width">
                <input matInput
                       name="email"
                       formControlName="email"
                       placeholder="{{'PERSON_FORM.EMAIL_PLACEHOLDER' | translate}}">
                <mat-error *ngIf="validateError('email') && getErrors('email').required">
                  {{'PERSON_FORM.EMAIL_ERROR' | translate}}
                </mat-error>
              </mat-form-field>
            </div>


            <div fxLayout="row"
                 fxLayout.xs="column">
              <div fxLayout="column"
                   class="custom-container"
                   fxFlex="50"
                   fxFlex.xs="100"
                   fxFlex.sm="100">
                <div fxLayout="row"
                     fxLayout.xs="column"
                     fxLayoutAlign="space-between center"
                     fxLayoutAlign.xs="start stretch">

                  <div fxLayout="row"
                       fxFlex="50"
                       fxFlex.xs="100"
                       fxFlex.sm="100">
                    <mat-form-field fxFlex>
                      <input matInput
                             name="ahorro"
                             formControlName="ahorro"
                             type="number"
                             placeholder="{{'PERSON_FORM.AHORRO_PLACEHOLDER' | translate}}">
                    </mat-form-field>
                  </div>

                  <div fxLayout="row"
                       fxFlex="50"
                       fxFlex.xs="100"
                       fxFlex.sm="100">
                    <mat-form-field fxFlex>
                      <input matInput
                             name="ahorroPercentage"
                             type="number"
                             formControlName="ahorroPercentage"
                             placeholder="{{'PERSON_FORM.PERCENTAGE_PLACEHOLDER' | translate}}">
                    </mat-form-field>
                  </div>

                </div>

                <span fxShow.xs="false"
                      fxShow.sm="false"
                      fxShow.md="false"
                      class="custom-hint not-separated"> {{'PERSON_FORM.AHORRO_AND_PERCENTAGE_HINT' | translate}}
                </span>
              </div>

              <div fxLayout="row"
                   fxLayoutAlign="start center"
                   fxFlex>
                <mat-slide-toggle class="toggle-container"
                                  formControlName="enableNotify"
                                  fxFlex>{{'PERSON_FORM.NOTIFICATION_LABEL' | translate}}</mat-slide-toggle>
              </div>
            </div>

            <div fxLayout="row">
              <mat-form-field fxFlex
                              class="example-full-width">
                <input matInput
                       name="address"
                       formControlName="address"
                       placeholder="{{'PERSON_FORM.ADDRESS_PLACEHOLDER' | translate}}">
              </mat-form-field>
            </div>

            <div fxLayout="row"
                 fxLayout.xs="column">
              <div fxLayout="column"
                   fxFlex="50"
                   fxFlex.xs="100"
                   fxFlex.sm="100">
                <div fxLayout="row"
                     fxLayout.xs="column"
                     fxLayoutAlign="space-between center"
                     fxLayoutAlign.xs="start stretch">

                  <div fxLayout="row"
                       fxFlex="50"
                       fxFlex.xs="100"
                       fxFlex.sm="100">
                    <mat-form-field class="birthdate-container"
                                    fxFlex>
                      <input matInput
                             name="birthdate"
                             formControlName="birthdate"
                             [matDatepicker]="picker"
                             placeholder="{{'PERSON_FORM.BIRTHDAY_PLACEHOLDER' | translate}}">
                      <mat-datepicker-toggle matSuffix
                                             [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <div fxLayout="row"
                       fxFlex="50"
                       fxFlex.xs="100"
                       fxFlex.sm="100">
                    <mat-form-field fxFlex>
                      <mat-select placeholder="{{'PERSON_FORM.SEX_PLACEHOLDER' | translate}}"
                                  name="gender"
                                  formControlName="gender">
                        <mat-option *ngFor="let sexos of (viewdata$ | async)?.sexos "
                                    [value]="sexos">
                          {{sexos}}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </div>

                </div>
              </div>

              <div fxLayout="row"
                   fxLayoutAlign="start center"
                   fxFlex>
                <mat-form-field fxFlex>
                  <mat-select placeholder="{{'PERSON_FORM.STATUS_PLACEHOLDER' | translate}}"
                              name="status"
                              formControlName="status">
                    <mat-option *ngFor="let accountStatusList of (viewdata$ | async)?.accountStatusList  "
                                [value]="accountStatusList">
                      {{accountStatusList}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </section>

          <section fxLayout="column">
            <mat-accordion [multi]="true">
              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title class="mat-body-strong">
                    {{'PERSON_FORM.REGIONAL_DATA_PLACEHOLDER' | translate}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <section fxLayout="column">
                  <div fxLayout="row"
                       fxLayout.xs="column">
                    <div fxLayout="column"
                         fxFlex="50"
                         fxFlex.xs="100"
                         fxFlex.sm="100">
                      <div fxLayout="row"
                           class="expansion-custom-container"
                           fxLayout.xs="column"
                           fxLayoutAlign="space-between center"
                           fxLayoutAlign.xs="start stretch">

                        <div fxLayout="row"
                             fxFlex="50"
                             fxFlex.xs="100"
                             fxFlex.sm="100">
                          <mat-form-field fxFlex>
                            <mat-select placeholder="{{'PERSON_FORM.DATE_FORMAT_PLACEHOLDER' | translate}}"
                                        name="dateFormats"
                                        formControlName="dateFormats">
                              <mat-option *ngFor="let dateFormats of (viewdata$ | async)?.dateFormats "
                                          [value]="dateFormats">
                                {{dateFormats}}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>

                        <div fxLayout="row"
                             fxFlex="50"
                             fxFlex.xs="100"
                             fxFlex.sm="100">
                          <mat-form-field fxFlex>
                            <mat-select placeholder="{{'PERSON_FORM.HOUR_FORMAT_PLACEHOLDER' | translate}}"
                                        name="timeFormats"
                                        formControlName="timeFormats">
                              <mat-option *ngFor="let timeFormats of (viewdata$ | async)?.timeFormats "
                                          [value]="timeFormats">
                                {{timeFormats}}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>

                      </div>
                    </div>

                    <div fxLayout="row"
                         fxLayoutAlign="start center"
                         fxFlex>
                      <mat-form-field fxFlex>
                        <mat-select placeholder="{{'PERSON_FORM.ZONE_PLACEHOLDER' | translate}}"
                                    name="timeZones"
                                    formControlName="timeZones">
                          <mat-option *ngFor="let timeZones of (viewdata$ | async)?.timeZones "
                                      [value]="timeZones.timeZoneId">
                            {{timeZones.timeZoneName}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </div>

                  <div fxLayout="row"
                       fxLayout.xs="column"
                       fxLayoutAlign.xs="start stretch">
                    <div fxLayout="row"
                         fxFlex="50"
                         fxFlex.xs="100"
                         fxFlex.sm="100">
                      <mat-form-field fxFlex>
                        <mat-select placeholder="{{'PERSON_FORM.NATIONALITY_PLACEHOLDER' | translate}}"
                                    formControlName="nacionalidad">
                          <mat-option *ngFor="let country of (viewdata$ | async)?.countries "
                                      [value]="country.nombre">
                            {{country.nombre}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>

                    <div fxLayout="row"
                         fxFlex="15"
                         fxFlex.xs="100"
                         fxFlex.sm="100">
                      <mat-form-field fxFlex>
                        <mat-select placeholder="{{'PERSON_FORM.LANGUAGE_PLACEHOLDER' | translate}}"
                                    name="languageCodes"
                                    formControlName="languageCodes">
                          <mat-option *ngFor="let languageCodes of (viewdata$ | async)?.languageCodes "
                                      [value]="languageCodes">
                            {{languageCodes}}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </div>
                </section>

              </mat-expansion-panel>
              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title class="mat-body-strong">
                    {{'PERSON_FORM.PROPERIES_TITLE' | translate}}
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div fxLayout="column">
                  <mat-list dense
                            [disableRipple]="false"
                            *ngIf="(bienes$ | async)?.length > 0"
                            fxLayout="column"
                            fxFlex
                            fxLayoutAlign="space-between center">
                    <mat-list-item *ngFor="let bien of bienes$ | async; $index as i"
                                   fxFlex>
                      <div fxLayout="row"
                           fxLayoutAlign="start center"
                           fxFlex>
                        <div fxLayout="row"
                             fxFlex="30%"
                             fxLayoutAlign="center center"
                             fxLayoutAlign.xs="start center">{{bien.descripcion}}</div>
                        <div fxLayout="row"
                             fxFlex="30%"
                             fxFlex.xs="25%"
                             fxLayoutAlign="center center"
                             fxLayoutAlign.xs="start center">{{bien.tipo}}</div>
                        <div fxLayout="row"
                             fxFlex="30%"
                             fxFlex.xs="35%"
                             fxLayoutAlign="center center"
                             fxLayoutAlign.xs="start center">{{bien.valor | currency}}</div>
                        <div fxLayout="row"
                             fxFlex="10%"
                             fxLayoutAlign="center center">
                          <button mat-icon-button
                                  (click)="deleteProperty(bien.id)">
                            <mat-icon>delete_forever</mat-icon>
                          </button>
                        </div>
                      </div>
                      <mat-divider></mat-divider>
                    </mat-list-item>
                  </mat-list>

                  <span
                        *ngIf="form && form.bienes && !form.bienes.length > 0">{{'PERSON_FORM.PROPERIES_EMPTY' | translate}}</span>
                  <div class="agregar-bien-container">
                    <div fxLayout="row"
                         fxLayoutAlign="start center">
                      <button mat-button
                              (click)="openPropertiesDialog()">
                        <mat-icon>add_circle_outline</mat-icon>
                        <span class="agregar-bien-label">{{'PERSON_FORM.PROPERIES_ADD' | translate}}</span>
                      </button>
                    </div>
                  </div>
                </div>
              </mat-expansion-panel>
            </mat-accordion>
          </section>

          <section fxLayout="column">
            <div fxLayout="row">
              <mat-form-field fxFlex>
                <mat-label>{{'PERSON_FORM.COMMENTS_LABEL' | translate}}</mat-label>
                <textarea matInput
                          cdkTextareaAutosize
                          cdkAutosizeMinRows="2"
                          name="obs"
                          maxlength="255"
                          formControlName="obs"
                          cdkAutosizeMaxRows="5"></textarea>
                <mat-hint align="end">{{(form.obs)?.length | async}} / 255</mat-hint>
              </mat-form-field>
            </div>
          </section>

          <div fxFlexLayout="row"
               fxLayoutAlign="end center">
            <div class="button-container">
              <button mat-raised-button
                      (click)="goToPersonList()">{{'PERSON_FORM.CANCEL_BUTTON' | translate}}</button>
            </div>
            <div class="button-container">
              <button mat-raised-button
                      [disabled]="!form.valid"
                      (click)="action()"
                      color="primary">{{(viewdata$ | async)?.buttonActionText | translate}}</button>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
